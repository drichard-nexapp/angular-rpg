@if (loading()) {
<div class="loading">Loading maps...</div>
} @if (!loading() ) { @for (layer of layers(); track layer) {
<section class="layer-section">
  <h2>{{ layer }}</h2>
  <div class="map-container" #mapContainer>
    <div class="map-grid">
      @for (row of grid(); track $index) {
      <div class="map-row">
        @for (tile of row; track $index) { @if (tile) {
        <div
          class="map-tile ascii clickable"
          [class.has-character]="hasCharacter(tile)"
          [class.selected-tile]="isTileSelected(tile)"
          [style.background-image]="'url(' + getMapImageUrl(tile.skin) + ')'"
          (click)="onTileClick(tile)"
          (mouseenter)="onTileMouseEnter(tile)"
          (mouseleave)="onTileMouseLeave()"
        >
          @let characters = getCharactersAt(tile);
          <div class="tile-content">
            @if (characters.length > 0) {
            <div class="characters-overlay">
              @for (character of characters; track character.name) {
              <img
                [src]="getCharacterSkinImageUrl(character.skin)"
                [alt]="character.name"
                class="character-marker-image"
              />
              }
            </div>
            }
          </div>
        </div>
        } @else {
        <div class="map-tile empty"></div>
        } }
      </div>
      }
    </div>
  </div>
</section>
} @if (hoveredTile()) {
<div class="tile-tooltip">{{ getTileSummary(hoveredTile()) }}</div>
} }
