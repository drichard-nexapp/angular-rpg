<main class="main">
  <div class="content">
    <h1>Grand Exchange</h1>

    @if (loading()) {
      <div class="loading">Loading orders...</div>
    }
    @if (!loading()) {
      <div class="grand-exchange-container">
        <div class="ge-header">
          <div class="ge-stats">
            <h2>Available Orders: {{ ordersLength() }}</h2>
            <p class="cache-info">Data cached for 1 hour</p>
          </div>

          <div class="ge-actions">
            <button class="refresh-btn" type="button" (click)="refreshOrders()">ðŸ”„ Refresh</button>
            @if (searchTerm() || itemCodeFilter()) {
              <button class="clear-filters-btn" type="button" (click)="clearFilters()">Clear Filters</button>
            }
          </div>
        </div>

        <div class="ge-filters">
          <div class="filter-group">
            <label for="search">Search:</label>
            <input
              id="search"
              type="text"
              placeholder="Search by code, seller, or ID..."
              [value]="searchTerm()"
              (input)="setSearchTerm($any($event.target).value)" />
          </div>

          <div class="filter-group">
            <label for="item-code">Item Code:</label>
            <select id="item-code" [value]="itemCodeFilter()" (change)="setItemCodeFilter($any($event.target).value)">
              <option value="">All Items</option>
              @for (code of itemCodes(); track code) {
                <option [value]="code">{{ code }}</option>
              }
            </select>
          </div>
        </div>

        <div class="ge-orders-grid">
          @if (filteredOrders().length === 0) {
            <div class="no-orders">No orders found</div>
          }
          @for (order of filteredOrders(); track order.id) {
            <div class="order-card">
              <div class="order-header">
                <span class="order-item-code">{{ order.code }}</span>
                <span class="order-id">#{{ order.id.slice(0, 8) }}</span>
              </div>

              <div class="order-details">
                <div class="order-detail-item">
                  <span class="label">Seller:</span>
                  <span class="value">{{ order.seller }}</span>
                </div>

                <div class="order-detail-item">
                  <span class="label">Quantity:</span>
                  <span class="value quantity">{{ order.quantity }}</span>
                </div>

                <div class="order-detail-item">
                  <span class="label">Price/Unit:</span>
                  <span class="value price">ðŸ’° {{ order.price }}</span>
                </div>

                <div class="order-detail-item">
                  <span class="label">Total:</span>
                  <span class="value total">ðŸ’° {{ order.price * order.quantity }}</span>
                </div>

                <div class="order-detail-item">
                  <span class="label">Created:</span>
                  <span class="value">{{ order.created_at | date: 'short' }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>
</main>
